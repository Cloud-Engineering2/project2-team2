<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
	
	<link href="/css/register.css" rel="stylesheet">
 
</head>


<body class="d-flex align-items-center py-4 bg-body-tertiary">
  
 <div class="form-signin w-100 m-auto">
    
        <h2>요리왕 비룡의 레시피🎈 </h2>
        <form id="loginForm" action="/login" method="POST">
            <div class="form-floating mb-3">
                <label for="username">이름</label>
                <input type="text" class="form-control" id="username" name="username" placeholder="이름을 입력해주세요" required>
            </div>
            <div class="form-floating mb-3">
                <label for="password">비밀번호</label>
                <input type="password" class="form-control" id="password" name="password" placeholder="비밀번호를 입력해주세요.">
            </div>
            <button class="btn btn-primary w-100 py-2 mt-5" type="submit">로그인</button>
        </form>
         <p class="btn btn-secondary btn-md mt-5"><a href="/user/register" class="text-secondary-emphasis text-light">회원가입</a></p>    

  
</div>
    
  
    <script>	
	document.getElementById("loginForm").addEventListener("submit", function(e) {
	    e.preventDefault(); // 폼 제출 시 새로고침 방지

	    const loginData = {
	        username: document.getElementById("username").value,
	        password: document.getElementById("password").value
	    };

	    fetch("/user/login", {
	        method: "POST",
	        headers: {
	            "Content-Type": "application/json"
	        },
	        body: JSON.stringify(loginData)
	    })
	    .then(response => {
    if (!response.ok) {
        return response.text();  // 오류 응답은 텍스트로 반환
    }
    return response.json();  // 정상적인 응답은 JSON으로 처리
})

	.then(data => {
		if (data.token) {
	        // 토큰을 localStorage에 저장
	        localStorage.setItem("token", data.token);
	        console.log("Token saved:", data.token);

	        // 리다이렉트 처리
	        window.location.href = data.redirect || '/';  // redirect 값이 있으면 그 경로로, 없으면 기본 '/'로 리다이렉트
	    } else {
	        console.error("Token not found in response");
	    }
})
	    .catch(error => {
	        console.error("Error:", error);
	    });
	});

 
</script>
    
</body>
</html>
 